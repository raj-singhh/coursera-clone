<div class="course-detail-container" *ngIf="courseDetails; else loadingOrNotFound">
  <div class="container">
    <div class="course-header">
      <div class="header-content">
        <h1 class="course-title">{{ courseDetails.title }}</h1>
        <p class="course-instructor">By {{ courseDetails.instructor }}</p>
        <div class="course-meta">
          <span>{{ courseDetails.duration }} hours</span>
          <span>Rating: {{ courseDetails.rating }}</span>
        </div>
      </div>
    </div>

    <div class="course-body">
      <div class="main-content">
        <div class="video-player-container" *ngIf="currentCourseIsEnrolled && selectedLesson">
          <video #videoPlayer controls (timeupdate)="onVideoTimeUpdate()">
            <source [src]="selectedLesson.videoUrl" type="video/mp4">
          </video>
        </div>
        <img *ngIf="!currentCourseIsEnrolled" [src]="courseDetails.thumbnailUrl" alt="{{ courseDetails.title }}" class="course-thumbnail">
        <div class="course-description">
          <h2>About this course</h2>
          <p>{{ courseDetails.description }}</p>
        </div>
      </div>
      <div class="sidebar">
        <div class="sidebar-card">
          <span class="course-price">₹{{ courseDetails.price }}</span>
          <span class="text-sm text-gray-500 line-through ml-2">₹{{ courseDetails.price * 1.5 }}</span>
          <ng-container *ngIf="isLoggedIn$ | async; else notLoggedIn">
            <button *ngIf="!currentCourseIsEnrolled" (click)="payWithRazorpay()" class="btn btn-primary">
              Purchase Course
            </button>
            <span *ngIf="currentCourseIsEnrolled" class="enrolled-badge">Enrolled</span>
          </ng-container>
          <ng-template #notLoggedIn>
            <button (click)="router.navigate(['/login'])" class="btn btn-primary">
              Login to Enroll
            </button>
          </ng-template>
        </div>
        <div class="lessons-list" *ngIf="currentCourseIsEnrolled && lessons.length > 0">
          <h3>Course Content</h3>
          <ul>
            <li *ngFor="let lesson of lessons; trackBy: trackByLessonId" (click)="selectLesson(lesson)" [class.active]="selectedLesson?.id === lesson.id">
              <span>{{ lesson.lessonOrder }}. {{ lesson.title }}</span>
              <span *ngIf="isLessonCompleted(lesson.id)" class="completed-icon">✓</span>
            </li>
          </ul>
        </div>
        <div class="certificate-section" *ngIf="currentCourseIsEnrolled && isCourseCompleted">
          <button (click)="downloadCertificate()" class="btn btn-primary">
            Download Certificate
          </button>
          <button (click)="previewCertificate()" class="btn btn-secondary">
            Preview Certificate
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loadingOrNotFound>
  <div class="loading-container">
    <p>Loading course details...</p>
  </div>
</ng-template>
